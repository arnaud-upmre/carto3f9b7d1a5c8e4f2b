<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Beta ‚Äî Jeu des Postes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
  <style>

    /* ‚úÖ R√©sultat d‚Äôune manche */
#round-result {
  position:fixed; inset:0;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  backdrop-filter:blur(25px) saturate(1.6);
  -webkit-backdrop-filter:blur(25px) saturate(1.6);
  border:1px solid var(--border-light);
  border-radius:20px;
  margin:10px;
  text-align:center;
  padding:1.5rem;
  z-index:6800;
  animation: fadeIn .3s ease;
}
#round-result h1 { font-size:1.5rem; margin-bottom:.5rem; }
#round-result p { color:var(--muted); margin-bottom:1.2rem; }

   /* üü£ Style Apple-like */
:root {
  --glass-bg-light: rgba(255, 255, 255, 0.55);
  --glass-bg-dark: rgba(20, 20, 20, 0.55);
  --border-light: rgba(255,255,255,0.3);
  --border-dark: rgba(0,0,0,0.3);
}

/* Fonds frosted glass */
#overlay, #end-screen, #leaderboard, #welcome-screen {
  backdrop-filter: blur(25px) saturate(1.6);
  -webkit-backdrop-filter: blur(25px) saturate(1.6);
  border: 1px solid var(--border-light);
  border-radius: 20px;
  margin: 10px;
  animation: fadeIn .3s ease;
}
@media (prefers-color-scheme: dark) {
  #overlay, #end-screen, #leaderboard, #welcome-screen {
    border: 1px solid var(--border-dark);
  }
}
@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.98); }
  to { opacity: 1; transform: scale(1); }
}

/* Boutons arrondis */
.btn {
  border-radius: 9999px;
  padding: .7rem 1.4rem;
  font-weight: 600;
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.2);
  transition: all .2s ease;
}
.btn.primary {
  background: var(--accent);
  color: #fff;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}
.btn:active {
  transform: scale(0.96);
  opacity: 0.9;
}

/* Onglets classement fa√ßon iOS Segmented Control */
#leaderboard-tabs {
  display: flex;
  background: rgba(255,255,255,0.1);
  border-radius: 9999px;
  padding: .3rem;
  gap: .3rem;
}
.tab-btn {
  flex: 1;
  border-radius: 9999px;
  background: transparent;
  color: var(--ink);
}
.tab-btn.active {
  background: var(--accent);
  color: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.25);
  transition: background .3s ease;
}

/* Tableau classement √©pur√© */
#leaderboard {
  position:fixed; inset:0;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  background: var(--glass);
  z-index:6500; text-align:center; padding:1.5rem;
}
#leaderboard h1 { font-size:1.5rem; margin-bottom:1rem; }
#leaderboard table {
  width:90%; max-width:400px;
  border-collapse: collapse;
  background: rgba(255,255,255,0.05);
  border-radius: 12px;
  overflow: hidden;
  margin-bottom:1rem;
}
#leaderboard td, #leaderboard th {
  border-bottom: 1px solid rgba(255,255,255,0.08);
  padding:.6rem .4rem;
}
#leaderboard tr:last-child td { border-bottom: none; }
#leaderboard tr:nth-child(1) td { font-weight:700; color:gold; }
#leaderboard tr:nth-child(2) td { font-weight:700; color:silver; }
#leaderboard tr:nth-child(3) td { font-weight:700; color:#cd7f32; }

    
/* üü£ Topbar Apple-like */
.topbar {
  position: fixed;
  top: .8rem;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: .6rem;
  padding: .4rem .6rem;
  background: rgba(255,255,255,0.12);
  border: 1px solid rgba(255,255,255,0.25);
  border-radius: 9999px;
  backdrop-filter: blur(18px) saturate(1.6);
  -webkit-backdrop-filter: blur(18px) saturate(1.6);
  box-shadow: 0 8px 24px rgba(0,0,0,0.25);
  z-index: 7000;
}

/* Boutons topbar pills */
.topbar .btn {
  border-radius: 9999px;
  background: rgba(255,255,255,0.15);
  color: var(--ink);
  border: 1px solid rgba(255,255,255,0.25);
  padding: .5rem 1rem;
  font-size: .9rem;
  font-weight: 500;
  transition: all .2s ease;
}
.topbar .btn:active {
  transform: scale(0.95);
  background: rgba(255,255,255,0.3);
}

/* Ic√¥nes en ::before */
#btn-leaderboard::before { content: "üèÜ "; }
#btn-change-mode::before { content: "üîÑ "; }
#btn-exit::before { content: "üö™ "; }

/* Texte en desktop (affich√© avec ::after) */
@media (min-width: 481px) {
  #btn-leaderboard::after { content: "Classement"; }
  #btn-change-mode::after { content: "Changer de mode"; }
  #btn-exit::after { content: "Quitter"; }
}

    /* Taille des ic√¥nes dans la topbar */
.topbar .btn::before {
  font-size: 1rem;   /* taille emoji normale */
  line-height: 1;
}
    
/* Version mobile compacte (ic√¥nes seules) */
@media (max-width: 480px) {
  .topbar { gap: .3rem; padding: .3rem .5rem; }
  .topbar .btn { 
  padding: .35rem .6rem;
  font-size: .95rem;
}
  #btn-leaderboard::after,
  #btn-change-mode::after,
  #btn-exit::after { content: ""; }
}
    
    :root{
      --accent:#4f46e5; --bg:#0b0c0e; --card:#111317;
      --ink:#f9fafb; --muted:#9ca3af;
      --glass:rgba(17,19,23,.65); --border:rgba(255,255,255,.08);
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Roboto,Inter,Arial,sans-serif;}
    #map{width:100%;height:100%;}

    .btn{border:none;border-radius:.8rem;padding:.7rem 1.2rem;font-size:1rem;font-weight:600;cursor:pointer;}
    .btn.primary{background:var(--accent);color:#fff;}
    .btn:disabled{opacity:.5;cursor:not-allowed;}

    /* Overlay consigne */
    #overlay{
      position:fixed; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center;
      backdrop-filter:blur(20px) saturate(1.4); background:var(--glass);
      z-index:6000; text-align:center; padding:1.5rem;
    }
    #overlay h1{font-size:1.5rem; margin-bottom:.5rem;}
    #overlay p{color:var(--muted); margin-bottom:1.2rem;}

    /* HUD bas */
    .bottombar{
      position:fixed; bottom:0; left:0; right:0;
      display:flex; gap:.6rem; align-items:center; padding:.6rem .8rem;
      backdrop-filter:blur(12px) saturate(1.2);
      background:var(--glass); border-top:1px solid var(--border); z-index:5000;
    }
    .score{flex:1; font-variant-numeric:tabular-nums;}
    .score .pts{font-size:1.1rem; font-weight:700;}
    .score .dist{color:var(--muted); font-size:.9rem;}
    .toast{position:fixed; left:50%; bottom:90px; transform:translateX(-50%);
      background:var(--card); border:1px solid var(--border); padding:.5rem .9rem; border-radius:.7rem; display:none; z-index:6500;}
    
    /* ‚úÖ Nouvel √©cran d‚Äôaccueil */
    #welcome-screen{
      position:fixed; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center;
      backdrop-filter:blur(20px) saturate(1.4); background:var(--glass);
      z-index:7000; text-align:center; padding:1.5rem;
    }
    #welcome-screen h1{font-size:1.6rem; margin-bottom:1rem;}
    #welcome-screen input{padding:.6rem; border-radius:.6rem; border:1px solid var(--border); margin-bottom:1rem; width:70%; max-width:260px; text-align:center;}
    #welcome-screen button{margin:.3rem 0;}
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- ‚úÖ Barre en haut -->
<div class="topbar">
  <button class="btn" id="btn-leaderboard"></button>
  <button class="btn" id="btn-change-mode"></button>
  <button class="btn" id="btn-exit"></button>
</div>

  <!-- ‚úÖ Nouvel √©cran d‚Äôaccueil -->
  <div id="welcome-screen">
    <h1>Bienvenue üëã</h1>
    <p>Entrez votre pseudo :</p>
    <input type="text" id="input-pseudo" placeholder="Votre nom ou pseudo" />
    <p>Choisissez un mode :</p>
    <button class="btn primary" id="mode-decouverte">D√©couverte</button>
    <button class="btn primary" id="mode-normal">Normal</button>
    <button class="btn primary" id="mode-hard">Hard</button>

    <!-- ‚úÖ la s√©lection de zone doit √™tre ici -->
    <p>Choisissez une zone :</p>
    <div id="zone-select">
      <button class="btn" data-zone="">üåç Toutes</button>
      <button class="btn" data-zone="Hazebrouck">Hazebrouck</button>
      <button class="btn" data-zone="Amiens">Amiens</button>
      <button class="btn" data-zone="Valenciennes">Valenciennes</button>
    </div>
  </div> <!-- fin de #welcome-screen -->
  
  <!-- Overlay consigne -->
  <div id="overlay" style="display:none">
    <h1 id="consigne">Chargement‚Ä¶</h1>
    <p id="consigneType"></p>
    <button class="btn primary" id="btn-start">Commencer</button>
  </div>
  <!-- ‚úÖ R√©sultat d‚Äôune manche -->
<div id="round-result" style="display:none">
  <h1 id="round-title">R√©sultat</h1>
  <p id="round-details"></p>
  <button class="btn primary" id="btn-round-next">‚û°Ô∏è Suivant</button>
</div>

  <!-- ‚úÖ Overlay fin de partie -->
<div id="end-screen" style="display:none">
  <h1 id="end-title">Partie termin√©e üéâ</h1>
  <p id="end-details"></p>
  <button class="btn primary" id="btn-replay">üîÑ Rejouer</button>
  <button class="btn" id="btn-home">üè† Accueil</button>
</div>
<!-- ‚úÖ Overlay classement -->
<div id="leaderboard" style="display:none">
  <h1>üèÜ Classement</h1>
  <div id="leaderboard-tabs">
    <button class="btn tab-btn" data-mode="D√©couverte">D√©couverte</button>
    <button class="btn tab-btn" data-mode="Normal">Normal</button>
    <button class="btn tab-btn" data-mode="Hard">Hard</button>
  </div>
  <table id="leaderboard-table"></table>
  <button class="btn" id="btn-close-leaderboard">Fermer</button>
</div>
  
  <!-- HUD bas -->
  <div class="bottombar">
<div class="score">
  <span class="pts" id="scorePts">‚Äî pts</span> ¬∑
  <span class="dist" id="scoreDist">Clique sur la carte pour placer ta r√©ponse</span> ¬∑
  <span class="timer" id="scoreTimer"></span>
</div>
    <button class="btn" id="btn-validate" disabled>‚úÖ Valider</button>
 
  </div>

  <div class="toast" id="toast"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="">


  </script>
  <script>
   const $=s=>document.querySelector(s);
const toast=(m,ms=1600)=>{const t=$('#toast');t.textContent=m;t.style.display='block';clearTimeout(toast._to);toast._to=setTimeout(()=>t.style.display='none',ms);};

// ‚úÖ Zones g√©ographiques (centre + rayon 90 km)
const ZONES = {
  "Hazebrouck":   { lat: 50.727, lon: 2.537, rayon: 90000 },
  "Amiens":       { lat: 49.894, lon: 2.295, rayon: 90000 },
  "Valenciennes": { lat: 50.357, lon: 3.525, rayon: 90000 }
};
    
// ‚úÖ Pr√©-remplir le pseudo si d√©j√† enregistr√©
const savedPseudo = localStorage.getItem("pseudoJeuPostes");
if(savedPseudo){
  document.getElementById('input-pseudo').value = savedPseudo;
}
    
    function scoreFromMeters(m) {
  let seuil, step, maxDist;

  if (state.mode === "D√©couverte") {
    seuil = 30; step = 20; maxDist = 110;
  } 
  else if (state.mode === "Normal") {
    seuil = 25; step = 25; maxDist = 125;
  } 
  else if (state.mode === "Hard") {
    seuil = 20; step = 20; maxDist = 100;
  } 
  else {
    return 0; // s√©curit√© si mode inconnu
  }

  if (m <= seuil) return 5000;

  const over = Math.floor((m - seuil) / step) + 1;
  const score = 5000 - (over * 1000);

  return (score > 0 && m <= maxDist) ? score : 0;
}
    const formatMeters=m=>m<1000?`${m.toFixed(1)} m`:`${(m/1000).toFixed(3)} km`;

let DATA=[], state={
  target:null, 
  guess:null, 
  guessMarker:null, 
  realMarker:null, 
  line:null, 
  locked:false, 
  pseudo:null, 
  mode:null,
  postesJoues: [],
  zone:null   // ‚úÖ nouvelle propri√©t√©
};

    const map=L.map('map',{minZoom:3,maxZoom:19}).setView([46.7,2.3],6);

    // Fond IGN
    L.tileLayer(
      "https://data.geopf.fr/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&STYLE=normal&FORMAT=image/jpeg&LAYER=ORTHOIMAGERY.ORTHOPHOTOS&TILEMATRIXSET=PM&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}",
      { attribution: "¬© IGN-F/Geoportail", tileSize: 256, maxZoom: 19 }
    ).addTo(map);

    // Labels OSM
    L.tileLayer(
      "https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}{r}.png",
      { attribution: "&copy; OSM &copy; CARTO", subdomains: "abcd", tileSize: 256, transparent: true, maxZoom: 20 }
    ).addTo(map);

    function dotIcon(color){return L.divIcon({className:'',html:`<div style="width:14px;height:14px;border-radius:50%;border:2px solid #fff;background:${color};box-shadow:0 0 6px #0006"></div>`,iconSize:[14,14],iconAnchor:[7,7]});}
    const iconGuess=dotIcon('#ef4444'), iconReal=dotIcon('#22c55e');

    function resetRound(){
      if(state.guessMarker) map.removeLayer(state.guessMarker);
      if(state.realMarker) map.removeLayer(state.realMarker);
      if(state.line) map.removeLayer(state.line);
      state.guess=state.guessMarker=state.realMarker=state.line=null; state.locked=false;
      $('#btn-validate').disabled=true;
      $('#scorePts').textContent='‚Äî pts'; $('#scoreDist').textContent='Clique sur la carte pour placer ta r√©ponse';
    }

    function showOverlayFor(p){
      state.target=p;
      $('#consigne').textContent=`Retrouve le poste ${p.nom}`;
      $('#consigneType').textContent=`Type : ${p.type}`;
      $('#overlay').style.display='flex';
      state.postesJoues.push(p.nom);  // ‚úÖ on m√©morise le nom du poste jou√©
      resetRound();
    }

    function startRound(){ $('#overlay').style.display='none'; toast('Carte activ√©e'); }

    function validate(){
  if(!state.target||!state.guess||state.locked) return;
  const t=state.target,g=state.guess;
  const real=L.latLng(t.latitude,t.longitude);
  const dist=g.distanceTo(real), pts=scoreFromMeters(dist);

  // Marqueurs & ligne
  state.realMarker=L.marker(real,{icon:iconReal}).addTo(map);
  state.line=L.polyline([g,real],{color:'#fff',weight:2,opacity:.7,dashArray:'4 4'}).addTo(map);
  state.locked=true;

  if(state.mode === "Normal"){
    state.scoreTotal += pts;
    state.manches++;

    // üîπ Affiche le r√©sultat de la manche
    $('#round-details').textContent = `Manche ${state.manches} : ${pts} pts ‚Äì distance ${formatMeters(dist)}`;
    $('#round-result').style.display = 'flex';

if(state.manches >= 3){
  const elapsed = Math.round((Date.now() - state.startTime)/1000);
enregistrerFin(state.pseudo, state.mode, state.scoreTotal, 60, state.postesJoues);
  afficherFin(state.scoreTotal, elapsed); // Fin de partie
}
  }
  else if(state.mode === "Hard"){
    state.scoreTotal += pts;
  }
}

    map.on('click',e=>{
      if(state.locked||!state.target) return;
      if(state.guessMarker) map.removeLayer(state.guessMarker);
      state.guess=e.latlng;
      state.guessMarker=L.marker(e.latlng,{icon:iconGuess}).addTo(map);
      $('#btn-validate').disabled=false;
      $('#scoreDist').textContent='R√©ponse plac√©e ‚úî';
    });

    $('#btn-validate').onclick=validate;
    $('#btn-next').onclick=()=>{ pickRandom(); };
    $('#btn-start').onclick=startRound;

function pickRandom(){
  if(!DATA.length){toast('Pas de donn√©es charg√©es');return;}

  let pool = DATA;

  // ‚úÖ Filtrage si une zone est choisie
  if(state.zone && ZONES[state.zone]){
    const { lat, lon, rayon } = ZONES[state.zone];
    pool = DATA.filter(p => {
      const d = L.latLng(p.latitude,p.longitude)
                  .distanceTo(L.latLng(lat,lon));
      return d <= rayon;
    });
    if(pool.length === 0) pool = DATA; // fallback si aucun poste trouv√©
  }

  const i=Math.floor(Math.random()*pool.length);
  showOverlayFor(pool[i]);
}

    async function loadData(){
      try{
        const res = await fetch('postes.json');
        const arr = await res.json();
        DATA = arr.filter(p =>
          p && p.nom && p.nom.trim() !== "" &&
          p.type && p.type.trim() !== "" &&
          p.poste_latitude && p.poste_longitude &&
          !/acc[e√®]s/i.test(p.type) &&
          !/acc[e√®]s/i.test(p.nom||"")
        ).map(p => {
          let fullName = p.nom;
          if (p.SAT && p.SAT.trim() !== "") fullName += " " + p.SAT.trim();
          return { nom: fullName, latitude: +p.poste_latitude, longitude: +p.poste_longitude, type: p.type };
        });
        toast(`${DATA.length} postes charg√©s`);
      } catch(e){
        console.error(e);
        toast('Erreur chargement postes.json');
      }
    }
    loadData();

 
function enregistrerFin(pseudo, mode, score, time, postes) {
  fetch("https://script.google.com/macros/s/AKfycbz0qSFPCtj8jorBf8A-YHINxIpVF7RrJeNhb_nbxGFMep4Wl9cF0vcFVciQYfPTaW_-sA/exec", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ 
      pseudo, 
      mode, 
      score, 
      time, 
      postes 
    })
  })
  .then(r => r.json()).then(res => console.log("Enregistrement OK", res))
  .catch(err => console.error("Erreur enregistrement", err));
}

    // ‚úÖ Gestion du choix de mode
    document.getElementById('mode-decouverte').onclick = () => startWithMode('D√©couverte');
    document.getElementById('mode-normal').onclick = () => startWithMode('Normal');
    document.getElementById('mode-hard').onclick = () => startWithMode('Hard');

   function startWithMode(modeChoice) {
  const input = document.getElementById('input-pseudo').value.trim();
  if (!input) { toast('Veuillez entrer un pseudo'); return; }
  state.pseudo = input; 
  state.mode = modeChoice;
     state.postesJoues = []; // ‚úÖ on repart avec une liste vide de postes
     localStorage.setItem("pseudoJeuPostes", state.pseudo);

  // Initialisation sp√©cifique aux modes
  if(modeChoice === "Normal"){
    state.manches = 0;
    state.scoreTotal = 0;
    state.startTime = Date.now();
  }

if(modeChoice === "Hard"){
  state.scoreTotal = 0;
  state.timeLeft = 60; // secondes
  $('#scoreTimer').textContent = `‚è±Ô∏è ${state.timeLeft}s`;

  state.timer = setInterval(()=>{
    state.timeLeft--;
    $('#scoreTimer').textContent = `‚è±Ô∏è ${state.timeLeft}s`;

    if(state.timeLeft <= 0){
      clearInterval(state.timer);
      enregistrerFin(state.pseudo, state.mode, state.scoreTotal, 60);
     afficherFin(state.scoreTotal, 60);
      $('#scoreTimer').textContent = ""; // on efface le chrono
    }
  },1000);
}

  document.getElementById('welcome-screen').style.display = 'none';
  pickRandom(); // d√©marre directement une manche
}

    // Gestion des boutons du topbar
document.getElementById('btn-change-mode').onclick = () => {
  // Reset complet
  resetRound();
  state = {target:null, guess:null, guessMarker:null, realMarker:null, line:null, locked:false, pseudo:null, mode:null};
  document.getElementById('welcome-screen').style.display = 'flex';
  document.getElementById('overlay').style.display = 'none';
  toast("Mode r√©initialis√©");
};

document.getElementById('btn-exit').onclick = () => {
  window.location.href = "index.html"; // adapte le chemin selon ta structure
};

function afficherFin(score, time) {
  $('#round-result').style.display = 'none'; // masque le dernier r√©sultat
  $('#end-details').textContent = `${state.pseudo} en mode ${state.mode} ‚Äì ${score} pts ‚Äì ${time}s`;
  $('#end-screen').style.display = 'flex';

  // ‚úÖ Envoi Sheet d√®s qu‚Äôon affiche la fin
  if(state.mode === "D√©couverte"){
    enregistrerFin(state.pseudo, state.mode, 0, 0, state.postesJoues);
  } else {
    enregistrerFin(state.pseudo, state.mode, score, time, state.postesJoues);
  }
}
    
    // Boutons √©cran de fin
document.getElementById('btn-replay').onclick = () => {
  $('#end-screen').style.display = 'none';
  if(state.mode === "Normal"){
    state.manches = 0;
    state.scoreTotal = 0;
    state.startTime = Date.now();
  }
  if(state.mode === "Hard"){
    state.scoreTotal = 0;
    state.timeLeft = 60;
    $('#scoreTimer').textContent = `‚è±Ô∏è ${state.timeLeft}s`;
    state.timer = setInterval(()=>{
      state.timeLeft--;
      $('#scoreTimer').textContent = `‚è±Ô∏è ${state.timeLeft}s`;
      if(state.timeLeft <= 0){
        clearInterval(state.timer);
        enregistrerFin(state.pseudo, state.mode, state.scoreTotal, 60);
        afficherFin(state.scoreTotal, 60);
        $('#scoreTimer').textContent = "";
      }
    },1000);
  }
  pickRandom();
};

document.getElementById('btn-home').onclick = () => {
  $('#end-screen').style.display = 'none';
  document.getElementById('welcome-screen').style.display = 'flex';
};

 async function chargerClassement(mode) {
  try {
    const res = await fetch("https://script.google.com/macros/s/AKfycbz0qSFPCtj8jorBf8A-YHINxIpVF7RrJeNhb_nbxGFMep4Wl9cF0vcFVciQYfPTaW_-sA/exec");
    const data = await res.json();

    let scores = Array.isArray(data) ? data : (data.records || []);

    // Filtre par mode choisi
    scores = scores.filter(s => s.mode === mode);

    // Tri : d'abord score d√©croissant, puis temps croissant
    scores.sort((a,b)=> b.score - a.score || a.time - b.time);

    // Top 10
    scores = scores.slice(0,10);

    const table = document.getElementById("leaderboard-table");
    table.innerHTML = `
      <tr><th>Joueur</th><th>Score</th><th>Temps</th></tr>
      ${scores.map(s=>`
        <tr>
          <td>${s.pseudo}</td>
          <td>${s.score}</td>
          <td>${s.time}s</td>
        </tr>`).join("")}
    `;
  } catch(e) {
    console.error(e);
    document.getElementById("leaderboard-table").innerHTML = "<tr><td colspan='3'>Erreur chargement</td></tr>";
  }
}

    // Gestion des onglets classement
document.querySelectorAll(".tab-btn").forEach(btn=>{
  btn.onclick = ()=>{
    document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    const mode = btn.getAttribute("data-mode");
    chargerClassement(mode);
  };
});

// Ouvrir classement par d√©faut sur "Normal"
document.getElementById("btn-leaderboard").onclick = ()=>{
  document.getElementById("leaderboard").style.display = "flex";
  document.querySelector('.tab-btn[data-mode="Normal"]').click();
};
document.getElementById("btn-close-leaderboard").onclick = ()=>{
  document.getElementById("leaderboard").style.display = "none";
};
    // ‚úÖ Bouton "Suivant" apr√®s une manche
document.getElementById('btn-round-next').onclick = ()=>{
  $('#round-result').style.display = 'none';
  pickRandom();
};
    // ‚úÖ Gestion des boutons de zones
document.querySelectorAll("#zone-select button").forEach(btn=>{
  btn.onclick = ()=>{
    state.zone = btn.dataset.zone || null;
    toast(state.zone ? "Zone choisie : "+state.zone : "Toutes zones activ√©es");
  };
});
    
  </script>
</body>
</html>
