<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Carte ‚Äî Postes & Appareils</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <style>
    :root {
      --accent: #4f46e5;
      --bg: #0b0c0e;
      --ink: #f9fafb;
      --glass: rgba(17, 19, 23, 0.65);
      --border: rgba(255, 255, 255, 0.12);
    }
    html, body {
      height: 100%;
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, sans-serif;
      background: var(--bg);
      color: var(--ink);
    }
    #map { width: 100%; height: 100%; }

    /* Barre style iOS */
    .topbar {
      position: fixed;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--glass);
      backdrop-filter: blur(10px);
      padding: .4rem .6rem;
      border-radius: 14px;
      border: 1px solid var(--border);
      box-shadow: 0 4px 12px rgba(0,0,0,.3);
      z-index: 1000;
    }
    .topbar button {
      border: none;
      background: transparent;
      color: var(--ink);
      font-size: 1.2rem;
      margin: 0 .2rem;
      padding: .4rem .8rem;
      border-radius: 9999px;
      cursor: pointer;
      transition: all .2s ease;
    }
    .topbar button.active {
      background: var(--accent);
      color: #fff;
    }
    .topbar button:hover {
      background: rgba(255,255,255,0.15);
    }
  </style>
</head>
<body>

  <!-- Barre sup√©rieure -->
  <div class="topbar">
    <button onclick="window.location.href='index.html'">üè†</button>
    <div>
      <button id="btn-postes" class="active">üìç</button>
      <button id="btn-appareils" class="active">‚ö°</button>
      <button id="btn-acces" class="active">üöô</button>
    </div>
  </div>

  <!-- Carte -->
  <div id="map"></div>

  <script>
    // Initialisation carte Leaflet
    const map = L.map('map').setView([46.8, 2.5], 6);

    // Fond IGN Orthophotos (libre acc√®s)
    L.tileLayer("https://wxs.ign.fr/ortho/geoportail/wmts?layer=ORTHOIMAGERY.ORTHOPHOTOS&style=normal&tilematrixset=PM&Service=WMTS&Request=GetTile&Version=1.0.0&Format=image/jpeg&TileMatrix={z}&TileCol={x}&TileRow={y}", {
      attribution: "¬© IGN",
      tileSize: 256
    }).addTo(map);

    // Groupes de couches
    const postesLayer = L.layerGroup().addTo(map);
    const appareilsLayer = L.layerGroup().addTo(map);
    const accesLayer = L.layerGroup().addTo(map);

    // Ic√¥nes personnalis√©es
    const iconPoste = L.divIcon({className:"", html:"üìç", iconSize:[24,24], popupAnchor:[0,-12]});
    const iconAppareil = L.divIcon({className:"", html:"‚ö°", iconSize:[24,24], popupAnchor:[0,-12]});
    const iconAcces = L.divIcon({className:"", html:"üöô", iconSize:[24,24], popupAnchor:[0,-12]});

    // Charger les donn√©es JSON
    fetch("data.json")
      .then(r => r.json())
      .then(data => {
        data.forEach(item => {
          if(!item.latitude || !item.longitude) return;
          const coords = [item.latitude, item.longitude];
          let marker, popup = `<b>${item.nom || "Sans nom"}</b><br>Type: ${item.type || ""}<br>Ligne: ${item.lignes || ""}<br>PK: ${item.pk || ""}`;

          if(item.type && item.type.toLowerCase().includes("poste")) {
            marker = L.marker(coords, {icon: iconPoste}).bindPopup(popup).addTo(postesLayer);
          }
          else if(item.type && (item.type.toLowerCase().includes("acc√®s") || item.type.toLowerCase().includes("acces"))) {
            marker = L.marker(coords, {icon: iconAcces}).bindPopup(popup).addTo(accesLayer);
          }
          else {
            marker = L.marker(coords, {icon: iconAppareil}).bindPopup(popup).addTo(appareilsLayer);
          }
        });
      });

    // Gestion des filtres
    const btnPostes = document.getElementById("btn-postes");
    const btnAppareils = document.getElementById("btn-appareils");
    const btnAcces = document.getElementById("btn-acces");

    btnPostes.onclick = () => {
      if(map.hasLayer(postesLayer)) { map.removeLayer(postesLayer); btnPostes.classList.remove("active"); }
      else { map.addLayer(postesLayer); btnPostes.classList.add("active"); }
    };
    btnAppareils.onclick = () => {
      if(map.hasLayer(appareilsLayer)) { map.removeLayer(appareilsLayer); btnAppareils.classList.remove("active"); }
      else { map.addLayer(appareilsLayer); btnAppareils.classList.add("active"); }
    };
    btnAcces.onclick = () => {
      if(map.hasLayer(accesLayer)) { map.removeLayer(accesLayer); btnAcces.classList.remove("active"); }
      else { map.addLayer(accesLayer); btnAcces.classList.add("active"); }
    };
  </script>
</body>
</html>