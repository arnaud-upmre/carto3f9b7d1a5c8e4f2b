<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"
  />
  <title>➕ Ajouter un appareil</title>

  <style>
    .field-hint{font-size:13px;color:#c62828;margin-top:6px;display:none}
    .field-hint.show{display:block}
    input.error, textarea.error {border:2px solid #c62828!important;background:#ffecec}

    *,*::before,*::after{box-sizing:border-box}
    body{margin:0;padding:16px;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#f7f7f8;color:#202124}
    h2{text-align:center;margin:0 0 12px}
    .card{max-width:640px;margin:auto;background:#fff;padding:16px;border-radius:14px;box-shadow:0 2px 6px rgba(0,0,0,.15)}
    label{display:block;margin:12px 0 6px;font-weight:600}
    input,textarea{width:100%;padding:12px;font-size:16px;border:1px solid #d0d7de;border-radius:10px;background:#fff;color:#202124;min-height:44px}
    textarea{min-height:96px;resize:none}
    .pill-group{display:flex;gap:10px;margin:12px 0}
    .pill{flex:1;text-align:center;padding:12px;border:1px solid #d0d7de;border-radius:999px;cursor:pointer}
    .pill.active{background:#0b6cff;color:#fff;border:1px solid #0b6cff}
    .pill.error{border:2px solid #c62828!important;background:#ffecec}
    .btn-row{display:flex;gap:12px;margin-top:18px}
    .btn{flex:1;padding:12px;font-size:16px;border:none;border-radius:10px;cursor:pointer}
    .btn.primary{background:#0b6cff;color:#fff;transition:background 0.3s}
    .btn.primary:disabled{opacity:0.6;cursor:not-allowed}
    .btn.secondary{background:#ccc}
    .step{display:none;animation:fade .3s ease}
    .step.active{display:block}
    @keyframes fade{from{opacity:0;transform:translateX(10px)}to{opacity:1;transform:translateX(0)}}
    #progress{margin-bottom:12px;text-align:center;color:#666}
    #progressbar{width:100%;height:6px;background:#d0d7de;border-radius:4px;overflow:hidden;margin-bottom:8px}
    #progressbar-fill{height:100%;width:0%;background:#0b6cff;transition:width 0.3s ease}
    #confirmationStep.active ~ #cancel-row {display:none}
  </style>
</head>
<body>
  <h2>➕ Ajouter un appareil</h2>
  <div class="card">
    <div id="progressbar"><div id="progressbar-fill"></div></div>
    <div id="progress">Étape 1/9</div>
    <form id="formAppareil" novalidate>

      <!-- Intro -->
      <div class="step active" id="introStep">
        <p style="text-align:center;color:#666;margin-bottom:20px;line-height:1.5">⏱️ Quelques secondes suffisent pour ajouter un appareil.</p>
        <div class="btn-row">
          <button type="button" class="btn primary" id="startForm">🚀 Commencer</button>
        </div>
      </div>

      <!-- Étape 1 -->
      <div class="step">
        <label>👤 Demandeur :</label>
        <input id="demandeur" required>
        <div class="btn-row"><button type="button" class="btn primary next">Suivant ➡️</button></div>
      </div>

      <!-- Étape 2 -->
      <div class="step">
        <label>📌 Poste :</label>
        <input id="poste" required placeholder="Ex : Hazebrouck">
        <label>📌 Type (optionnel) :</label>
        <input id="type" placeholder="Ex : SP, SSP, PRCI...">
        <div class="btn-row">
          <button type="button" class="btn secondary prev">⬅️ Retour</button>
          <button type="button" class="btn primary next">Suivant ➡️</button>
        </div>
      </div>

      <!-- Étape 3 -->
      <div class="step">
        <label>📌 SAT associé :</label>
        <input id="sat" placeholder="Exemple : SAT1, SAT2">
        <div class="btn-row">
          <button type="button" class="btn secondary prev">⬅️ Retour</button>
          <button type="button" class="btn primary next">Suivant ➡️</button>
        </div>
      </div>

      <!-- Étape 4 -->
      <div class="step">
        <label>💡 Nom de l’appareil :</label>
        <input id="appareil" required placeholder="Ex : I7112">
        <div class="btn-row">
          <button type="button" class="btn secondary prev">⬅️ Retour</button>
          <button type="button" class="btn primary next">Suivant ➡️</button>
        </div>
      </div>

      <!-- Étape 5 -->
      <div class="step">
        <label>🔗 Lien Google Maps de l’appareil :</label>
        <input id="lien" type="url" required placeholder="https://maps.app.goo.gl/…">
        <div id="lienHelp" class="field-hint">⚠️ Lien requis pour continuer</div>
        <div class="btn-row">
          <button type="button" class="btn secondary prev">⬅️ Retour</button>
          <button type="button" class="btn primary next">Suivant ➡️</button>
        </div>
      </div>

      <!-- Étape 6 -->
      <div class="step">
        <label>🚪 L’appareil a-t-il un accès routier distinct ?</label>
        <div class="pill-group">
          <div class="pill" id="pill-acces-oui" data-value="oui">✅ Oui</div>
          <div class="pill" id="pill-acces-non" data-value="non">❌ Non</div>
        </div>
        <input type="hidden" id="accessValue">
        <div class="btn-row">
          <button type="button" class="btn secondary prev">⬅️ Retour</button>
          <button type="button" class="btn primary next">Suivant ➡️</button>
        </div>
      </div>

      <!-- Étape 7 -->
      <div class="step" id="accessDetailsStep">
        <label>🔗 Lien Google Maps accès :</label>
        <input id="lienAccess" type="url" placeholder="https://maps.app.goo.gl/…">
        <div id="lienAccessHelp" class="field-hint">⚠️ Lien requis pour continuer</div>
        <div class="btn-row">
          <button type="button" class="btn secondary prev">⬅️ Retour</button>
          <button type="button" class="btn primary next">Suivant ➡️</button>
        </div>
      </div>

      <!-- Étape 8 -->
      <div class="step">
        <label>📝 Notes complémentaires :</label>
        <textarea id="infos" placeholder="Accès, portail…"></textarea>
        <div class="btn-row">
          <button type="button" class="btn secondary prev">⬅️ Retour</button>
          <button type="button" class="btn primary next">Suivant ➡️</button>
        </div>
      </div>

      <!-- Étape 9 -->
      <div class="step">
        <p>🎉 Super, presque terminé ! Vérifiez ci-dessous :</p>
        <div id="recap"></div>
        <div class="btn-row">
          <button type="button" class="btn secondary prev">⬅️ Retour</button>
          <button type="submit" class="btn primary">📩 Envoyer</button>
        </div>
      </div>

      <!-- Confirmation -->
      <div class="step" id="confirmationStep">
        <h3 style="text-align:center">✅ Merci ! Votre demande a bien été envoyée.</h3>
        <div class="btn-row">
          <button type="button" class="btn secondary" onclick="window.location.href='index.html'">🏠 Retour à l’accueil</button>
          <button type="button" class="btn primary" onclick="resetForm()">➕ Ajouter un autre appareil</button>
        </div>
      </div>

      <div id="cancel-row" class="btn-row" style="margin-top:12px">
        <button type="button" class="btn secondary" onclick="window.location.href='index.html'">❌ Annuler et revenir à l’accueil</button>
      </div>
    </form>
  </div>

<script>
let currentStep=0, returnToRecap=false;
const steps=document.querySelectorAll(".step:not(#introStep):not(#confirmationStep)");
const progress=document.getElementById("progress");

function showStep(i){
  steps.forEach((s,idx)=>s.classList.toggle("active",idx===i));
  document.getElementById("progressbar-fill").style.width=((i+1)/steps.length*100)+"%";
}

function $(id){return document.getElementById(id);}
function markError(input, helpEl, on){input.classList.toggle("error",!!on);if(helpEl)helpEl.classList.toggle("show",!!on)}

document.querySelectorAll(".next").forEach(btn=>{
  btn.addEventListener("click",e=>{
    e.preventDefault();
    if(currentStep===4 && !$("lien").value.trim()){markError($("lien"),$("lienHelp"),true);return;}
    if(currentStep===5 && !$("accessValue").value){document.querySelectorAll("#pill-acces-oui,#pill-acces-non").forEach(p=>p.classList.add("error"));return;}
    if(currentStep===6 && $("accessValue").value==="oui" && !$("lienAccess").value.trim()){markError($("lienAccess"),$("lienAccessHelp"),true);return;}
    currentStep++;showStep(currentStep);
  });
});

document.querySelectorAll(".prev").forEach(btn=>btn.addEventListener("click",()=>{if(currentStep>0){currentStep--;showStep(currentStep)}}));

$("pill-acces-oui").onclick=()=>{$("accessValue").value="oui";$("pill-acces-oui").classList.add("active");$("pill-acces-non").classList.remove("active");document.querySelectorAll("#pill-acces-oui,#pill-acces-non").forEach(p=>p.classList.remove("error"))};
$("pill-acces-non").onclick=()=>{$("accessValue").value="non";$("pill-acces-non").classList.add("active");$("pill-acces-oui").classList.remove("active");document.querySelectorAll("#pill-acces-oui,#pill-acces-non").forEach(p=>p.classList.remove("error"))};

$("formAppareil").onsubmit=e=>{
  e.preventDefault();
  const formData=new URLSearchParams();
  formData.append("demandeur",$("demandeur").value.trim());
  formData.append("poste",$("poste").value.trim());
  formData.append("type",$("type").value.trim());
  formData.append("sat",$("sat").value.trim());
  formData.append("appareil",$("appareil").value.trim());
  formData.append("localisation",$("lien").value.trim());
  formData.append("acces",$("accessValue").value==="oui"?$("lienAccess").value.trim():"");
  formData.append("notes",$("infos").value.trim());

  const submitBtn=document.querySelector('.btn.primary[type="submit"]');
  const oldLabel=submitBtn.textContent;
  submitBtn.disabled=true;submitBtn.textContent="⏳ Envoi en cours…";

  fetch("https://script.google.com/macros/s/AKfycbz8lUhVMKOrRSdeNBeA0p4ZsQCNOesB0Y4DL27KAoHkHWS78hOqrW-t-9bC_azgN-mY/exec",{method:"POST",body:formData})
  .then(()=>{steps.forEach(s=>s.classList.remove("active"));document.getElementById("confirmationStep").classList.add("active")})
  .finally(()=>{submitBtn.disabled=false;submitBtn.textContent=oldLabel});
};

document.getElementById("startForm").onclick=()=>{document.getElementById("introStep").style.display="none";showStep(0)};
</script>
</body>
</html>
