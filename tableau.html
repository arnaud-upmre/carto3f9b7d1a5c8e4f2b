<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Tableau Blanc ‚Äì Nono Maps</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

<style>

/* ============================
   Espacement header
================================ */
.board-row + .board-row{
    margin-top:14px;
}


/* ===============================
   Liens cliquables (poste / sat)
================================ */
.section-title,
.sat-pill{
    text-decoration:none;
    color:inherit;
    cursor:pointer;
}


/* ===============================
   Popup bienvenue
================================ */
.welcome-overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.45);
    backdrop-filter:blur(4px);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:9999;
}
.welcome-overlay.hidden{
    display:none;
}

.welcome-modal{
    background:var(--card-bg);
    color:var(--text);
    max-width:460px;
    width:90%;
    padding:24px 26px;
    border-radius:20px;
    box-shadow:0 20px 50px rgba(0,0,0,0.35);
    animation:popupIn 0.35s ease;
    text-align:center;
}

.welcome-modal h2{
    margin:0 0 14px;
    font-size:22px;
    font-weight:800;
    font-family:"Comic Sans MS","Bradley Hand","Segoe Print",Inter,system-ui,sans-serif;
}

.welcome-modal p{
    font-size:14px;
    line-height:1.5;
    margin-bottom:14px;
}

.welcome-modal button{
    margin-top:10px;
    padding:10px 18px;
    border:none;
    border-radius:14px;
    background:#1a73e8;
    color:white;
    font-weight:700;
    cursor:pointer;
    box-shadow:0 6px 16px rgba(26,115,232,0.4);
}

.welcome-modal button:active{
    transform:translateY(1px);
}

@keyframes popupIn{
    from{
        opacity:0;
        transform:translateY(10px) scale(0.97);
    }
    to{
        opacity:1;
        transform:translateY(0) scale(1);
    }
}


/* ===============================
   Variables th√®me
================================ */
:root{
    --bg:#f2f3f7;
    --card-bg:#ffffff;
    --text:#111;
    --pill-bg:#e5ebff;
    --pill-text:#1a4ce8;
    --sat-bg:#fff6c4;
    --sat-text:#8a6d00;
    --shadow:rgba(0,0,0,0.12);
}

@media (prefers-color-scheme: dark){
    :root{
        --bg:#1c1d20;
        --card-bg:#2a2b2e;
        --text:#f5f5f5;
        --pill-bg:#2f3b57;
        --pill-text:#9bb8ff;
        --sat-bg:#695a00;
        --sat-text:#ffe58a;
        --shadow:rgba(0,0,0,0.45);
    }
}


/* ===============================
   Base layout
================================ */
body{
    font-family:Inter,sans-serif;
    margin:0;
    padding:20px;
    background:var(--bg);
    color:var(--text);
}

h1{
    display:none;
}


/* ===============================
   Pills
================================ */
.pill,
.sat-pill,
.section-title,
.type-pill{
    display:inline-block;
}

.pill{
    padding:4px 8px;
    background:var(--pill-bg);
    color:var(--pill-text);
    border-radius:10px;
    font-size:12px;
    margin:4px 6px 4px 0;
    cursor:pointer;
    transition:0.15s;
}

.pill:hover{
    transform:translateY(-2px);
    box-shadow:0 3px 10px rgba(0,0,0,0.25);
}

.type-pill{
    background:var(--pill-bg);
    color:var(--pill-text);
    padding:4px 10px;
    border-radius:8px;
    font-size:12px;
    margin-left:6px;
}

.sat-pill,
.section-title{
    background:var(--sat-bg);
    color:var(--sat-text);
    padding:4px 10px;
    font-size:12px;
    border-radius:10px;
    font-weight:600;
    margin-bottom:8px;
}

.hp .pill{
    background:rgba(220,53,69,0.18);
    color:#b02a37;
}

@media (prefers-color-scheme: dark){
    .hp .pill{
        background:rgba(220,53,69,0.35);
        color:#ffb3b8;
    }
}


/* ===============================
   Cartes / grille
================================ */
.post-container{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
    gap:20px;
}

.card{
    background:var(--card-bg);
    padding:14px;
    border-radius:14px;
    box-shadow:0 4px 12px var(--shadow);
    border:1px solid rgba(255,255,255,0.05);
    opacity:0;
    transform:translateY(10px);
    animation:fadeIn 0.45s ease forwards;
}

.card-title{
    font-size:18px;
    font-weight:700;
    margin-bottom:14px;
}

.sat-block{
    margin-top:16px;
    padding-top:12px;
    border-top:1px dashed #ccc;
}

@keyframes fadeIn{
    to{
        opacity:1;
        transform:translateY(0);
    }
}


/* ===============================
   Tabs / filtres / search
================================ */
.tabs{
    display:flex;
    gap:10px;
    margin-bottom:20px;
}

.tab{
    padding:8px 16px;
    background:#d0d2d8;
    border-radius:12px;
    cursor:pointer;
    font-weight:600;
    transition:0.2s;
}

.tab.active{
    background:#1a73e8;
    color:white;
    box-shadow:0 3px 8px rgba(0,0,0,0.25);
}

#search{
    width:100%;
    padding:12px 18px;
    font-size:15px;
    border-radius:14px;
    border:1px solid #bbb;
    background:var(--card-bg);
    color:var(--text);
}

#search:focus{
    border-color:#1a73e8;
    box-shadow:0 0 0 3px #1a73e825;
}

.filters{
    display:flex;
    gap:10px;
    margin-bottom:20px;
    flex-wrap:wrap;
}

.filters button{
    padding:8px 16px;
    border-radius:10px;
    background:var(--card-bg);
    border:1px solid #bbb;
    cursor:pointer;
    font-weight:600;
}

.filters button.activeFilter{
    background:#1a73e8;
    color:white;
}


/* ===============================
   Header / navigation
================================ */
.board-header{
    position:sticky;
    top:0;
    z-index:50;
    margin-bottom:16px;
    padding:14px;
    border-radius:18px;
    backdrop-filter:blur(8px);
    box-shadow:0 10px 26px rgba(0,0,0,0.10);
}

.board-top,
.board-row{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    flex-wrap:wrap;
}

.board-title{
    font-size:22px;
    font-weight:800;
    transform:rotate(-0.4deg);
    font-family:"Comic Sans MS","Bradley Hand","Segoe Print",Inter,system-ui,sans-serif;
}

.btn-home{
    border-radius:14px;
    padding:10px 12px;
    font-weight:800;
    cursor:pointer;
}


/* ===============================
   Switch
================================ */
.mode-switch{
    display:flex;
    align-items:center;
    gap:10px;
    margin-top:8px;
}

.mode-label{
    font-size:13px;
    font-weight:600;
    opacity:0.5;
}

.mode-label.active{
    opacity:1;
}

.switch{
    width:44px;
    height:24px;
    background:#d0d2d8;
    border-radius:999px;
    position:relative;
    cursor:pointer;
}

.switch .knob{
    width:18px;
    height:18px;
    background:white;
    border-radius:50%;
    position:absolute;
    top:3px;
    left:3px;
}

.switch.hp{
    background:#1a73e8;
}

.switch.hp .knob{
    left:23px;
}


/* ===============================
   Mobile
================================ */
@media (max-width:480px){
    .card{
        padding:14px;
        border-radius:14px;
    }

    .card-title{
        font-size:16px;
    }

    .pill{
        font-size:12px;
        padding:4px 8px;
    }

    .sat-pill,
    .section-title{
        font-size:12px;
        padding:4px 10px;
    }
}

</style>

    
</head>
<body>

<div class="board-header">
  <div class="board-top">
    <div>
      <div class="board-title">Tableau blanc ‚Äî Nono Maps</div>
      <div class="board-sub" id="counters">Chargement‚Ä¶</div>
    </div>

    <button class="btn-home" onclick="location.href='index.html'">‚Üê Accueil</button>
  </div>

  <div class="board-row">
<div class="mode-switch">
  <span class="mode-label active" id="label-patrimoine">Patrimoine</span>

  <div class="switch" id="mode-switch">
    <div class="knob"></div>
  </div>

  <span class="mode-label" id="label-hp">Hors patrimoine</span>
</div>
  </div>

  <div class="board-row">
    <input id="search" type="text" placeholder="Rechercher...">
  </div>
</div> 


<div class="filters">
    <button data-sort="az">A ‚Üí Z</button>
    <button data-sort="za">Z ‚Üí A</button>
    <button data-sort="appmax">+ appareils</button>
    <button data-sort="appmin">- appareils</button>
</div>

<div id="postesZone" class="post-container patrimoine"></div>

<script>



const url="https://arnaud-upmre.github.io/carto3f9b7d1a5c8e4f2b/appareils.json";
let appareils=[];
let groupesGlobaux={};
let groupesAffiches={};
let triActif = "az";
let mode = "patrimoine";

const postesZone = document.getElementById("postesZone");
const switchEl = document.getElementById("mode-switch");

const labelPat = document.getElementById("label-patrimoine");
const labelHp = document.getElementById("label-hp");

switchEl.onclick = () => {
    if (mode === "patrimoine") {
        mode = "hp";
        afficher(appliquerTri(groupesGlobaux.hp));

        postesZone.classList.add("hp");
        postesZone.classList.remove("patrimoine");

        switchEl.classList.add("hp");
        labelHp.classList.add("active");
        labelPat.classList.remove("active");
    } else {
        mode = "patrimoine";
        afficher(appliquerTri(groupesGlobaux.patrimoine));

        postesZone.classList.remove("hp");
        postesZone.classList.add("patrimoine");

        switchEl.classList.remove("hp");
        labelPat.classList.add("active");
        labelHp.classList.remove("active");
    }
};

function groupAppareils(liste){
    const g = {};
    liste.forEach(a => {
        const key = `${a.nom}__${a.type || ""}`;
        if (!g[key]) g[key] = [];
        g[key].push(a);
    });
    return g;
}

    function appliquerTri(groupes){
    let noms = Object.keys(groupes);

    if(triActif==="az") noms.sort();
    if(triActif==="za") noms.sort().reverse();
    if(triActif==="appmax") noms.sort((a,b)=>groupes[b].length - groupes[a].length);
    if(triActif==="appmin") noms.sort((a,b)=>groupes[a].length - groupes[b].length);

    const sorted = {};
    noms.forEach(n => sorted[n] = groupes[n]);
    return sorted;
}


function majCompteurs(groupes){
    let total = 0;
    Object.values(groupes).forEach(list => {
        total += list.length;
    });

    document.getElementById("counters").textContent =
        `Nombre d‚Äôappareils : ${total}`;
}

async function charger(){
    const res=await fetch(url);
    appareils=await res.json();

    groupesGlobaux={
        patrimoine: groupAppareils(appareils.filter(a=>a.hors_patrimoine!==true)),
        hp:         groupAppareils(appareils.filter(a=>a.hors_patrimoine===true))
    };


    const noms=Object.keys(groupesGlobaux.patrimoine).sort();
    const sorted={};
    noms.forEach(n=>sorted[n]=groupesGlobaux.patrimoine[n]);

    afficher(sorted);
}

function afficher(groupes){
    groupesAffiches=groupes;
    majCompteurs(groupes);
    const zone=document.getElementById("postesZone");
    zone.innerHTML="";

Object.keys(groupes).forEach(key=>{
    const list = groupes[key];

    const nom = list[0].nom;
    const type = list[0].type || "";
    
        const principal = list
    .filter(a=>!a.SAT)
    .sort((a,b)=>a.appareil.localeCompare(b.appareil));

        const principalPills = principal.map(a=>{
    const id = `${a.appareil} ${a.nom} ${a.type||""} ${a.SAT||""}`.trim();
    return `<span class="pill" onclick="location.href='index.html?id=${encodeURIComponent(id)}'">${a.appareil}</span>`;
}).join("");
        
        const sats=list.filter(a=>a.SAT);

        const satGroup={};
        sats.forEach(a=>{
            if(!satGroup[a.SAT]) satGroup[a.SAT]=[];
            satGroup[a.SAT].push(a);
        });

const hasType = !!type;

let html=`
<div class="card">
<div class="card-title">
    ${hasType ? nom : `${nom} (Ville de)`}
    ${hasType ? `<span class="type-pill">${type}</span>` : ""}
</div>

${hasType && principal.length > 0
    ? `<a class="section-title"
         href="index.html?id=${encodeURIComponent(`${nom} ${type||""}`.trim())}">
         Poste principal
       </a>`
    : ""
}

${principal.length > 0 ? principalPills : ""}
`;

    const satKeys = Object.keys(satGroup).sort();
const hasPrincipal = principal.length > 0;
    
satKeys.forEach((s, idx) => {
    
    const appareilsSat = satGroup[s].sort((a,b)=>a.appareil.localeCompare(b.appareil));
    const withSeparator =
        (hasPrincipal && idx === 0) ||
        (satKeys.length > 1 && idx > 0);

    html += `
<div class="${withSeparator ? "sat-block" : ""}">

<a class="sat-pill"
   href="index.html?id=${encodeURIComponent(`${nom} ${type||""} ${s}`.trim())}">
   ${s}
</a>

    ${appareilsSat.map(a=>{
        const id = `${a.appareil} ${a.nom} ${a.type||""} ${a.SAT||""}`.trim();
        return `<span class="pill" onclick="location.href='index.html?id=${encodeURIComponent(id)}'">${a.appareil}</span>`;
    }).join("")}
</div>`;
});

        html+="</div>";
        zone.innerHTML+=html;
    });
}


document.getElementById("search").addEventListener("input", function () {
    const txt = this.value.trim().toLowerCase();
    const base = groupesGlobaux[mode];

    if (txt === "") {
        afficher(base);
        return;
    }

    const r = {};

    Object.keys(base).forEach(nomPoste => {
        const appareils = base[nomPoste];

        const matchNomPoste = nomPoste.toLowerCase().includes(txt);
        const matchAppareil = appareils.some(a =>
            (a.appareil || "").toLowerCase().includes(txt)
        );

        if (matchNomPoste || matchAppareil) {
            r[nomPoste] = appareils;
        }
    });

    afficher(r);
});

document.querySelectorAll(".filters button").forEach(btn=>{
    btn.onclick=()=>{
        document.querySelectorAll(".filters button").forEach(b=>b.classList.remove("activeFilter"));
        btn.classList.add("activeFilter");

const sort = btn.dataset.sort;
triActif = sort;
        let noms=Object.keys(groupesAffiches);

        if(sort==="az") noms.sort();
        if(sort==="za") noms.sort().reverse();
        if(sort==="appmax") noms.sort((a,b)=>groupesAffiches[b].length - groupesAffiches[a].length);
        if(sort==="appmin") noms.sort((a,b)=>groupesAffiches[a].length - groupesAffiches[b].length);

        const sorted={};
        noms.forEach(n=>sorted[n]=groupesAffiches[n]);

        afficher(sorted);
    };
});
charger();

document.querySelector('[data-sort="az"]')?.click();

</script>



    <div id="welcome-overlay" class="welcome-overlay hidden">
  <div class="welcome-modal">
    <h2>Bienvenue sur le Tableau blanc</h2>

    <p>
      Cette page est encore en <strong>b√™ta</strong>.<br>
      Elle regroupe tous les appareils pr√©sents sur Nono Maps afin d‚Äôoffrir
      une lecture plus globale et diff√©rente.
    </p>

    <p>
      Le tableau √©voluera au fil du temps.<br>
      <strong>N‚Äôh√©sitez pas √† me signaler tout bug ou souci d‚Äôaffichage üòâ</strong>
    </p>

    <button id="welcome-close">J‚Äôai compris</button>
  </div>
</div>

    <script>
const popupKey = "nonomaps_tableau_blanc_beta_seen";

window.addEventListener("load", () => {
    if (!localStorage.getItem(popupKey)) {
        document.getElementById("welcome-overlay").classList.remove("hidden");
    }
});

document.getElementById("welcome-close").onclick = () => {
    localStorage.setItem(popupKey, "true");
    document.getElementById("welcome-overlay").classList.add("hidden");
};
</script>


</body>
</html>
