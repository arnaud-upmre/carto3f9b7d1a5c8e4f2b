<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Tableau Blanc â€“ Nono Maps</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

<style>

/* ============================================
   ðŸŒ™ MODE CLAIR + SOMBRE AUTOMATIQUE
============================================ */
:root{
    --bg:#eef0f5;
    --glass-bg:rgba(255,255,255,0.55);
    --glass-border:rgba(255,255,255,0.35);
    --text:#111;
    --pill-bg:#edf1ff;
    --pill-text:#2f5edb;
    --sat-bg:#fff4b8;
    --sat-text:#7a5f00;
    --shadow:rgba(0,0,0,0.10);
}

@media (prefers-color-scheme: dark){
    :root{
        --bg:#1c1d20;
        --glass-bg:rgba(255,255,255,0.05);
        --glass-border:rgba(255,255,255,0.10);
        --text:#f4f4f4;
        --pill-bg:#2b3348;
        --pill-text:#aec4ff;
        --sat-bg:#5c4a00;
        --sat-text:#ffd76c;
        --shadow:rgba(0,0,0,0.6);
    }
}

body{
    font-family: Inter, sans-serif;
    margin:0;
    padding:20px;
    background:var(--bg);
    color:var(--text);
}

/* ============================================
   CARDS â€“ GLASSMORPHISM iOS
============================================ */
.card{
    background:var(--glass-bg);
    backdrop-filter:blur(14px);
    -webkit-backdrop-filter:blur(14px);
    padding:16px 18px;
    border-radius:20px;
    border:1px solid var(--glass-border);
    box-shadow:0 6px 18px var(--shadow);
    animation:fadeIn 0.45s ease forwards;
    opacity:0;
    transform:translateY(8px);
}

@keyframes fadeIn{
    to{
        opacity:1;
        transform:translateY(0);
    }
}

/* ============================================
   TITRE : NOM + TYPE
============================================ */
.card-title{
    font-size:17px;
    font-weight:700;
    margin-bottom:10px;
    display:flex;
    align-items:center;
    gap:6px;
}

.type-pill{
    background:var(--pill-bg);
    color:var(--pill-text);
    padding:3px 8px;
    border-radius:6px;
    font-size:11px;
    font-weight:600;
}

/* ============================================
   PILLS APPAREILS (affinÃ©es iOS)
============================================ */
.pill{
    display:inline-block;
    padding:4px 8px;
    font-size:11px;
    background:var(--pill-bg);
    color:var(--pill-text);
    border-radius:9px;
    margin:3px 4px 3px 0;
    cursor:pointer;
    transition:0.15s;
}

.pill:hover{
    transform:translateY(-1px);
    box-shadow:0 3px 8px rgba(0,0,0,0.18);
}

/* ============================================
   SAT pills plus sobres
============================================ */
.sat-pill{
    background:var(--sat-bg);
    color:var(--sat-text);
    padding:4px 12px;
    font-size:12px;
    border-radius:8px;
    font-weight:600;
    margin-top:8px;
    margin-bottom:6px;
    display:inline-block;
    opacity:0.95;
}

.section-title{
    background:var(--sat-bg);
    color:var(--sat-text);
    padding:4px 10px;
    border-radius:8px;
    font-size:12px;
    font-weight:600;
    margin-bottom:5px;
    display:inline-block;
}

/* Trait SAT plus fin */
.sat-block{
    margin-top:12px;
    padding-top:8px;
    border-top:1px dashed rgba(0,0,0,0.12);
}

/* ============================================
   RECHERCHE / FILTRES / ONGLETS
============================================ */

#search{
    border-radius:14px;
    background:var(--glass-bg);
    border:1px solid var(--glass-border);
    backdrop-filter:blur(10px);
    color:var(--text);
}

.filters button{
    background:var(--glass-bg);
    border:1px solid var(--glass-border);
    backdrop-filter:blur(8px);
    border-radius:10px;
    transition:0.15s;
    font-size:13px;
    padding:6px 12px;
}
.filters button:hover{
    transform:translateY(-1px);
    box-shadow:0 3px 10px var(--shadow);
}
.filters button.activeFilter{
    background:#1a73e8;
    color:white;
    border-color:#1a73e8;
}

.tab{
    border-radius:14px;
    background:var(--glass-bg);
    border:1px solid var(--glass-border);
    backdrop-filter:blur(12px);
}
.tab.active{
    background:#1a73e8;
    color:white;
}

</style>
</head>
<body>

<h1>Tableau blanc â€“ Nono Maps</h1>
<div id="counters">Chargementâ€¦</div>

<div class="tabs">
    <div class="tab active" id="tab-patrimoine">Patrimoine</div>
    <div class="tab" id="tab-hp">Hors Patrimoine</div>
</div>

<input id="search" type="text" placeholder="Rechercher un posteâ€¦">

<div class="filters">
    <button data-sort="az">A â†’ Z</button>
    <button data-sort="za">Z â†’ A</button>
    <button data-sort="appmax">+ appareils</button>
    <button data-sort="appmin">- appareils</button>
</div>

<div id="postesZone" class="post-container"></div>

<script>

/* --- EXACTEMENT ton JS prÃ©cÃ©dent, sauf affichage du type + SAT jaune --- */

const url="https://arnaud-upmre.github.io/carto3f9b7d1a5c8e4f2b/appareils.json";
let appareils=[];
let groupesGlobaux={};
let groupesAffiches={};
let mode="patrimoine";

/* Groupement */
function groupAppareils(liste){
    const g={};
    liste.forEach(a=>{
        if(!g[a.nom]) g[a.nom]=[];
        g[a.nom].push(a);
    });
    return g;
}

/* Compteurs */
function majCompteurs(groupes){
    const noms=Object.keys(groupes);
    let total=0;
    noms.forEach(n=> total+=groupes[n].length);
    document.getElementById("counters").textContent=
        `Nombre de postes : ${noms.length} â€” Nombre dâ€™appareils : ${total}`;
}

/* Chargement */
async function charger(){
    const res=await fetch(url);
    appareils=await res.json();

    groupesGlobaux={
        patrimoine: groupAppareils(appareils.filter(a=>a.hors_patrimoine!==true)),
        hp:         groupAppareils(appareils.filter(a=>a.hors_patrimoine===true))
    };

    // tri par dÃ©faut A-Z
    const noms=Object.keys(groupesGlobaux.patrimoine).sort();
    const sorted={};
    noms.forEach(n=>sorted[n]=groupesGlobaux.patrimoine[n]);

    afficher(sorted);
}

/* Affichage */
function afficher(groupes){
    groupesAffiches=groupes;
    majCompteurs(groupes);
    const zone=document.getElementById("postesZone");
    zone.innerHTML="";

    Object.keys(groupes).forEach(nom=>{
        const list=groupes[nom];

        const type=list[0].type || "";

        const principal=list.filter(a=>!a.SAT).sort((a,b)=>a.appareil.localeCompare(b.appareil));
        const sats=list.filter(a=>a.SAT);

        const satGroup={};
        sats.forEach(a=>{
            if(!satGroup[a.SAT]) satGroup[a.SAT]=[];
            satGroup[a.SAT].push(a);
        });

        let html=`
        <div class="card">
            <div class="card-title">
                ${nom}
                <span class="type-pill">${type}</span>
            </div>

            <div class="section-title">Poste principal</div>
            ${principal.length ? principal.map(a=>{
                const id=`${a.appareil} ${a.nom} ${a.type||""} ${a.SAT||""}`.trim();
                return `<span class="pill" onclick="location.href='index.html?id=${encodeURIComponent(id)}'">${a.appareil}</span>`;
            }).join("") : "<em>Aucun appareil</em>"}
        `;

        Object.keys(satGroup).sort().forEach(s=>{
            const appareilsSat=satGroup[s].sort((a,b)=>a.appareil.localeCompare(b.appareil));

            html+=`
            <div class="sat-block">
                <span class="sat-pill">${s}</span><br>
                ${appareilsSat.map(a=>{
                    const id=`${a.appareil} ${a.nom} ${a.type||""} ${a.SAT||""}`.trim();
                    return `<span class="pill" onclick="location.href='index.html?id=${encodeURIComponent(id)}'">${a.appareil}</span>`;
                }).join("")}
            </div>`;
        });

        html+="</div>";
        zone.innerHTML+=html;
    });
}

/* Onglets */
document.getElementById("tab-patrimoine").onclick=()=>{
    mode="patrimoine";
    afficher(groupesGlobaux.patrimoine);
    document.getElementById("tab-patrimoine").classList.add("active");
    document.getElementById("tab-hp").classList.remove("active");
};
document.getElementById("tab-hp").onclick=()=>{
    mode="hp";
    afficher(groupesGlobaux.hp);
    document.getElementById("tab-hp").classList.add("active");
    document.getElementById("tab-patrimoine").classList.remove("active");
};

/* Recherche */
document.getElementById("search").addEventListener("input",function(){
    const txt=this.value.trim().toLowerCase();
    const base=groupesGlobaux[mode];
    if(txt==="") return afficher(base);

    const r={};
    Object.keys(base).forEach(n=>{
        if(n.toLowerCase().includes(txt)) r[n]=base[n];
    });
    afficher(r);
});

/* Tri */
document.querySelectorAll(".filters button").forEach(btn=>{
    btn.onclick=()=>{
        document.querySelectorAll(".filters button").forEach(b=>b.classList.remove("activeFilter"));
        btn.classList.add("activeFilter");

        const sort=btn.dataset.sort;
        let noms=Object.keys(groupesAffiches);

        if(sort==="az") noms.sort();
        if(sort==="za") noms.sort().reverse();
        if(sort==="appmax") noms.sort((a,b)=>groupesAffiches[b].length - groupesAffiches[a].length);
        if(sort==="appmin") noms.sort((a,b)=>groupesAffiches[a].length - groupesAffiches[b].length);

        const sorted={};
        noms.forEach(n=>sorted[n]=groupesAffiches[n]);

        afficher(sorted);
    };
});

charger();

</script>

</body>
</html>
